# <span>HerokuとGitHubの両方にプッシュする時の</span><span>秘密にしたい値の扱い</span>

HerokuとGitHubの両方にプッシュできるようになったのはいいけど、例えばTwitterのOAuth認証用のトークンとか、何かのAPIを利用するためのAPIキーとか、あるいはもっと大事な何かのパスワードなど、秘密にしておきたい情報はGitHubにプッシュしてしまうと全世界に公開されるので非常にマズい。

かといって書いておかないと、Herokuにプッシュしたときに情報が足らなくてアプリが正常に動かない。どうするん？ 毎回消したり書いたりするの？って悩んでたら、Herokuヘビーユーザーな先人達が[既に解決していた](http://docs.komagata.org/4548)。

<!-- READMORE -->


## herokuコマンドでconfigオプション

解決策を読んでみると、`heroku`コマンドにはそのためのオプションがちゃんと用意されていて、それを使えばスマートに処理できるとのこと。ようは、`heroku`コマンドで秘密にしておきたい情報を仕込んでおけば、rubyスクリプト内でそれを呼び出せるようになる。

~~~ sh
$ heroku config:add HOGE="ほげほげ"
~~~

上記のように設定すると、rubyスクリプト内で以下のようにして ENV['addで指定したキー'] 経由で呼び出せる。

~~~ ruby
get '/hoge' do
  ENV['HOGE']
end
~~~

これでHerokuにプッシュして、<http://heroku-hello-world.heroku.com/hoge>にアクセスすれば、addで指定した値である「ほげほげ」がちゃんと表示される。また、GitHubにはこのままプッシュしても値は表示されないので何も問題がない。

## 削除したいときはremove

設定した情報を削除したいとき`remove`を使って、

~~~ sh
$ heroku config:remove HOGE
~~~

で消せる。全部のENV情報を消す`clear`というのもあるんだけど、これは将来的なバージョンで使えなくなるっぽい。現在設定されている情報の一覧は`heroku config`で表示できる。Herokuって素晴らしいですね。


## ローカルプレビューの時は？

問題はローカルプレビューの時はどうするのかな？と。上記のやり方は`heroku`コマンドを利用したときのみに有効になるっぽいので、ローカルでテストしているときは使えない。

今のところ、`ENV['HOGE']`の値が`nil`だったら、秘密情報が書かれたローカル用のファイルを`require`する、というような記述をして、そのファイルに定数として値を持たせる方法を使っている。で、そのファイルは`.gitignore`でアップロードしないように、と。

この方法はあんまりスマートじゃない気がするけど、一応目的は満たせている。もっと良い方法があったら教えてください。

---

<cite>[Heroku - ソース中のパスワードなどの処理 - komagata ［p0t］](http://docs.komagata.org/4548)</cite>
